/*!
 * Layzr.js 2.0.0 - A small, fast, modern, and dependency-free library for lazy loading.
 * Copyright (c) 2015 Michael Cavalea - http://callmecavs.github.io/layzr.js/
 * License: MIT
 */
!function(t,e){if("function"==typeof define&&define.amd)define("Layzr",["exports","module"],e);else if("undefined"!=typeof exports&&"undefined"!=typeof module)e(exports,module);else{var n={exports:{}};e(n.exports,n),t.Layzr=n.exports}}(this,function(t,e){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=function(){function t(){var e=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];i(this,t),this.selector=n.selector||"[data-layzr]",this.srcsetAttr=n.srcsetAttr||"data-layzr",this.bgAttr=n.bgAttr||"data-layzr-bg",this.threshold=n.threshold||0,this.callback=n.callback||void 0,this.prevLocation=0,this.ticking=!1,this.eventsBound=!1,this.eventHandler=function(){return e._requestLocation()}}return r(t,[{key:"run",value:function(){this.elements=this._getElements(),!this.eventsBound&&this._bindEvents(),this.eventHandler()}},{key:"_bindEvents",value:function(){window.addEventListener("scroll",this.eventHandler,!1),window.addEventListener("resize",this.eventHandler,!1),this.eventsBound=!0}},{key:"_unbindEvents",value:function(){window.removeEventListener("scroll",this.eventHandler,!1),window.removeEventListener("resize",this.eventHandler,!1),this.eventsBound=!1}},{key:"_requestLocation",value:function(){this.prevLocation=window.pageYOffset,this._requestTick()}},{key:"_requestTick",value:function(){var t=this;this.ticking||(requestAnimationFrame(function(){return t._update()}),this.ticking=!0)}},{key:"_getElements",value:function(){return Array.prototype.slice.call(document.querySelectorAll(this.selector))}},{key:"_getOffset",value:function(t){var e=t.getBoundingClientRect(),n=e.top+this.prevLocation;return{top:n,bottom:n+e.height}}},{key:"_inViewport",value:function(t){var e=this.threshold/100*this.windowHeight,n=this.prevLocation,i=n+this.windowHeight,r=this._getOffset(t);return r.top>=n-e&&r.bottom<=i+e}},{key:"_getSource",value:function(t){var e=this,i=window.devicePixelRatio,r=t.getAttribute(this.srcsetAttr).split(",").map(function(t){return t.trim()}),s=r.map(function(t){return t.split(" ").shift()}),o=r.map(function(t){var n=t.split(" ").pop(),i=parseInt(n,10);return i/e.windowWidth}),a=o.filter(function(t){return t>i}),u=o.filter(function(t){return i>t}),l=0===a.length?Math.max.apply(Math,n(u)):Math.min.apply(Math,n(a));return s[o.indexOf(l)]}},{key:"_removeAttributes",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;e>i;i++)n[i-1]=arguments[i];n.forEach(function(e){return t.removeAttribute(e)})}},{key:"_reveal",value:function(t){var e=this._getSource(t);t.hasAttribute(this.bgAttr)?t.style.backgroundImage='url("'+e+")":t.setAttribute("src",e),"function"==typeof this.callback&&this.callback.call(t),this._removeAttributes(t,this.srcsetAttr,this.bgAttr),this.elements=this._getElements(),0===this.elements.length&&this._unbindEvents()}},{key:"_update",value:function(){var t=this;this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.elements.forEach(function(e){return t._inViewport(e)&&t._reveal(e)}),this.ticking=!1}}]),t}();e.exports=s});